<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Nai Nai ‚Äî Prototipo completo</title>

<!-- ======= STYLES (dark / neon) ======= -->
<style>
:root{
  --bg:#05040a;
  --panel:#0c1220;
  --card:#0f1724;
  --muted:#9fb0d6;
  --text:#eaf6ff;
  --accent1:#4cc9f0;
  --accent2:#9b5de5;
  --success:#5fe3a1;
  --danger:#ff5c7c;
  --border: rgba(255,255,255,0.04);
  --glass: rgba(255,255,255,0.03);
  --max-width:1100px;
  font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg),#030312);color:var(--text);-webkit-font-smoothing:antialiased}
a{color:var(--accent1)}

.app{
  max-width:var(--max-width);margin:0 auto;min-height:100vh;display:flex;flex-direction:column;
}

/* header */
.header{
  display:flex;align-items:center;gap:12px;padding:14px;border-bottom:1px solid var(--border);
  background:linear-gradient(180deg,rgba(2,6,23,0.6),transparent);position:sticky;top:0;z-index:80;
}
.brand{display:flex;align-items:center;gap:10px}
.logo{width:44px;height:44px;border-radius:10px;background:linear-gradient(90deg,var(--accent1),var(--accent2));display:flex;align-items:center;justify-content:center;font-weight:900;color:#021018}
.brand-name{font-weight:800;color:var(--accent1);font-size:18px}
.search{flex:1;display:flex;gap:8px;align-items:center}
.search input{flex:1;padding:8px 12px;border-radius:10px;border:1px solid var(--border);background:rgba(255,255,255,0.02);color:var(--text)}
.header-actions{display:flex;gap:8px;align-items:center}

/* nav buttons (Videos / Subir / Perfil) */
.main-nav{display:flex;gap:8px;padding:12px;border-bottom:1px solid var(--border);background:linear-gradient(180deg,rgba(0,0,0,0.25),transparent)}
.nav-btn{padding:10px 14px;border-radius:999px;border:1px solid var(--border);background:transparent;color:var(--muted);cursor:pointer}
.nav-btn.active{background:linear-gradient(90deg,var(--accent1),var(--accent2));color:#021018;border:none;box-shadow:0 6px 18px rgba(76,201,240,0.08)}

/* layout */
.layout{display:grid;grid-template-columns:1fr 340px;gap:18px;padding:18px}
@media(max-width:980px){.layout{grid-template-columns:1fr;padding:12px}}

/* left - feed */
.feed-col{}
.tagbar{display:flex;gap:8px;overflow:auto;padding-bottom:8px;margin-bottom:6px}
.tag{padding:8px 12px;border-radius:999px;border:1px solid var(--border);background:transparent;color:var(--muted);cursor:pointer;white-space:nowrap}
.tag.active{background:linear-gradient(90deg,var(--accent1),var(--accent2));color:#021018;border:none}

/* feed items */
.feed-list{display:flex;flex-direction:column;gap:12px}
.card{background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);padding:12px;border-radius:12px;border:1px solid var(--border)}
.thumb{width:100%;height:260px;border-radius:10px;background:linear-gradient(180deg,#051226,#09233a);display:flex;align-items:center;justify-content:center;color:var(--muted);font-weight:800;font-size:18px}
.title{color:var(--accent1);font-weight:700;margin-top:10px}
.meta{color:var(--muted);font-size:13px;margin-top:6px}
.actions{display:flex;gap:8px;align-items:center;margin-top:10px}
.btn{padding:8px 10px;border-radius:8px;border:1px solid var(--border);background:transparent;color:var(--text);cursor:pointer}
.btn.primary{background:linear-gradient(90deg,var(--accent1),var(--accent2));border:none;color:#021018}
.badge{padding:4px 8px;border-radius:999px;background:rgba(255,255,255,0.02);border:1px solid var(--border);color:var(--muted);font-size:13px}
.counter{font-size:13px;color:var(--muted)}

/* comments */
.comment-area{margin-top:10px;border-top:1px dashed var(--border);padding-top:8px}
.comment{padding:8px;border-radius:8px;background:rgba(255,255,255,0.01);border:1px solid var(--border);margin-bottom:8px}
.comment .who{color:var(--muted);font-size:12px}

/* right - sidebar */
.sidebar{display:flex;flex-direction:column;gap:12px}
.panel{background:linear-gradient(180deg,var(--card),rgba(0,0,0,0.4));padding:12px;border-radius:12px;border:1px solid var(--border)}
.avatar{width:72px;height:72px;border-radius:12px;background:linear-gradient(90deg,var(--accent1),var(--accent2));display:flex;align-items:center;justify-content:center;font-weight:900;color:#021018}
.profile-row{display:flex;gap:12px;align-items:center}
.kv{font-size:13px;color:var(--muted)}

/* gua */
.gua-row{margin-top:10px}
.gua-bar{height:10px;background:rgba(255,255,255,0.02);border-radius:10px;overflow:hidden}
.gua-inner{height:100%;width:0%;background:linear-gradient(90deg,var(--accent1),var(--accent2));}

/* achievements */
.ach-grid{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
.ach{padding:6px 8px;border-radius:8px;border:1px solid var(--border);background:rgba(255,255,255,0.02);color:var(--muted);font-size:13px}

/* profile modal */
.modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.6);z-index:200}
.modal.show{display:flex}
.modal-card{width:95%;max-width:920px;background:linear-gradient(180deg,var(--panel),rgba(0,0,0,0.4));padding:16px;border-radius:12px;border:1px solid var(--border)}
.modal-head{display:flex;justify-content:space-between;align-items:center}
.close{background:transparent;border:none;color:var(--muted);font-size:20px;cursor:pointer}

/* forms */
.input, textarea, select{width:100%;padding:8px;border-radius:8px;border:1px solid var(--border);background:rgba(255,255,255,0.02);color:var(--text)}
.small{font-size:13px;color:var(--muted)}

/* footer small */
.footer-note{text-align:center;color:var(--muted);margin-top:12px;font-size:13px}
</style>
</head>
<body>
<div class="app">

  <!-- HEADER -->
  <header class="header">
    <div class="brand">
      <div class="logo">N</div>
      <div class="brand-name">Nai Nai</div>
    </div>

    <div class="search">
      <input id="searchInput" placeholder="Buscar por t√≠tulo, usuario, etiqueta..." />
      <button id="searchBtn" class="btn">Buscar</button>
    </div>

    <div class="header-actions">
      <button id="rulesBtn" class="btn">Reglas</button>
      <button id="loginBtn" class="btn">Entrar / Crear</button>
    </div>
  </header>

  <!-- NAV (Videos / Subir / Perfil) -->
  <nav class="main-nav">
    <button id="navVideos" class="nav-btn active">‚ñ∂ Ver videos</button>
    <button id="navUpload" class="nav-btn">‚§¥ Subir video</button>
    <button id="navProfile" class="nav-btn">üë§ Perfil</button>
  </nav>

  <!-- LAYOUT -->
  <div class="layout">

    <!-- LEFT: FEED -->
    <section class="feed-col">
      <div class="panel card">
        <div style="display:flex;gap:10px;align-items:center">
          <strong>Feed principal</strong>
          <div style="margin-left:auto" class="small">Algoritmo personalizable ‚Ä¢ Encuesta integrada</div>
        </div>

        <!-- initial sequence: rules accepted? inviter? -->
        <div id="welcomeBox" style="margin-top:12px"></div>

        <!-- tags -->
        <div id="tagbar" class="tagbar" style="margin-top:12px"></div>

        <!-- view controls -->
        <div style="display:flex;gap:8px;margin-top:12px;align-items:center">
          <label class="small">Formato</label>
          <select id="formatFilter" class="input" style="width:160px">
            <option value="both">Ambos</option>
            <option value="vertical">Vertical</option>
            <option value="horizontal">Horizontal</option>
          </select>

          <label class="small" style="margin-left:12px">Orden</label>
          <select id="orderBy" class="input" style="width:160px">
            <option value="new">M√°s recientes</option>
            <option value="gua">Por GUA</option>
          </select>
        </div>
      </div>

      <div id="feedList" class="feed-list" style="margin-top:12px"></div>

      <div class="footer-note">Nai Nai ‚Äî prototipo. Muchas funciones son demo y guardadas localmente.</div>
    </section>

    <!-- RIGHT: SIDEBAR -->
    <aside class="sidebar">
      <!-- PROFILE summary -->
      <div class="panel profile-summary">
        <div class="profile-row">
          <div class="avatar" id="avatarBadge">U</div>
          <div>
            <div id="displayName" style="font-weight:800">Invitado</div>
            <div id="accountNai" class="kv">.nai-guest</div>
            <div id="roleBadge" class="kv">Invitado</div>
          </div>
        </div>

        <div class="gua-row">
          <div class="kv">GUA: <strong id="guaValue">0</strong></div>
          <div class="gua-bar"><div class="gua-inner" id="guaInner"></div></div>
        </div>

        <div style="display:flex;gap:8px;margin-top:10px">
          <button id="btnOpenProfile" class="btn">Perfil</button>
          <button id="btnOpenUpload" class="btn">Subir</button>
        </div>

        <div style="margin-top:10px">
          <div class="small">Logros</div>
          <div id="achList" class="ach-grid"></div>
        </div>
      </div>

      <!-- uploader quick -->
      <div class="panel">
        <h4 style="margin:0">Subir video (r√°pido)</h4>
        <input id="quickTitle" class="input" placeholder="T√≠tulo" style="margin-top:8px"/>
        <input id="quickTags" class="input" placeholder="Etiquetas (coma)" style="margin-top:8px"/>
        <div style="display:flex;gap:8px;margin-top:8px">
          <button id="btnQuickPost" class="btn primary">Subir</button>
          <button id="btnOpenUploader" class="btn">Abrir</button>
        </div>
        <div class="small-muted" style="margin-top:8px">Recibir dinero depende de revisi√≥n y GUA.</div>
      </div>

      <!-- notes -->
      <div class="panel">
        <h4 style="margin:0">Block de notas</h4>
        <textarea id="noteBlock" rows="4" class="input" placeholder="Notas privadas (guardadas localmente)"></textarea>
        <div style="display:flex;gap:8px;margin-top:8px">
          <button id="saveNote" class="btn">Guardar</button>
          <button id="clearNote" class="btn secondary">Borrar</button>
        </div>
      </div>

      <!-- moderation demo -->
      <div class="panel">
        <h4 style="margin:0">Moderaci√≥n (demo)</h4>
        <div id="reportCount" class="kv small" style="margin-top:8px">Reportes: 0</div>
        <div style="display:flex;gap:8px;margin-top:8px">
          <button id="openMod" class="btn">Abrir panel</button>
        </div>
      </div>
    </aside>
  </div>

  <!-- Hidden Templates / Modals -->

  <!-- Rules modal (first time) -->
  <div id="rulesModal" class="modal">
    <div class="modal-card">
      <div class="modal-head">
        <div><h3>Reglas de la Comunidad ‚Äî Nai Nai</h3><div class="small">Lee antes de continuar</div></div>
        <button class="close" id="closeRules">‚úï</button>
      </div>
      <div style="margin-top:10px;max-height:55vh;overflow:auto">
        <p><strong>1.</strong> No contenido +18 sin la etiqueta adecuada (educativo o humor).</p>
        <p><strong>2.</strong> No agresi√≥n ni incitaci√≥n a da√±ar. Debate y s√°tira permitidos si est√° etiquetado.</p>
        <p><strong>3.</strong> Monetizaci√≥n: no autom√°tica. Depende de GUA, antig√ºedad y revisi√≥n humana. Auto-donaciones o fraude ‚Üí baneo permanente.</p>
        <p><strong>4.</strong> GUA: se gana por reportes v√°lidos, encuestas √∫tiles, registro con Gmail / .Nai (+10 cada una), subir v√≠deos etiquetados (+5‚Äì15). Se pierde por spam, reportes falsos, mal etiquetado o abuso. GUA = 0 ‚Üí Modo Solo Lectura.</p>
        <p><strong>5.</strong> Al aceptar confirmas que le√≠ste estos t√©rminos b√°sicos. En "Leer m√°s" encontrar√°s todo el detalle (roles, logros, modo fantasma, apelaciones).</p>
      </div>

      <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">
        <button id="btnReadMore" class="btn">Leer m√°s</button>
        <button id="btnAccept" class="btn primary">Aceptar y continuar</button>
      </div>
    </div>
  </div>

  <!-- Read More modal (full policies) -->
  <div id="readMoreModal" class="modal">
    <div class="modal-card">
      <div class="modal-head">
        <div><h3>Detalles completos ‚Äî Nai Nai</h3><div class="small">Reglas, GUA, monetizaci√≥n, roles y moderaci√≥n</div></div>
        <button class="close" id="closeReadMore">‚úï</button>
      </div>
      <div style="margin-top:12px;max-height:70vh;overflow:auto">
        <!-- (You can paste the long formal text here; for brevity key points are shown) -->
        <h4>Sistema GUA</h4>
        <p>Gana GUA por acciones que benefician la comunidad (reportes v√°lidos, encuestas √∫tiles, registro con Gmail/.Nai, subir contenido etiquetado). Pierde GUA por abuso, spam, reportes falsos o mal etiquetado.</p>

        <h4>Monetizaci√≥n</h4>
        <p>No garantizada. Se revisa manualmente. Si detectamos fraude, quitar dinero, permisos y ban permanente.</p>

        <h4>Roles</h4>
        <p>Usuario ‚Üí Subidor ‚Üí Creador Verificado ‚Üí Gestionador / Admin (por invitaci√≥n o confianza). Roles pueden renunciar y tomar descansos. Pagos ocasionales para gestionadores si aportan, no es sueldo fijo.</p>

        <h4>Modo Fantasma</h4>
        <p>Opciones por acci√≥n: ocultar nombre, foto o ambos cuando interact√∫as (likes, comentarios, donaciones, encuestas). Los administradores siempre ven la identidad real. No se puede evadir sanciones.</p>

        <h4>Apelaciones</h4>
        <p>Si recibes sanci√≥n puedes apelar contactando a los administradores desde el perfil.</p>
      </div>

      <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">
        <button id="closeReadMoreBtn" class="btn">Cerrar</button>
      </div>
    </div>
  </div>

  <!-- Inviter modal (asked after accepting rules) -->
  <div id="inviterModal" class="modal">
    <div class="modal-card">
      <div class="modal-head"><div><h3>¬øQui√©n te invit√≥ a Nai Nai? (opcional)</h3></div><button class="close" id="closeInviter">‚úï</button></div>
      <div style="margin-top:10px">
        <input id="inviterInput" class="input" placeholder="Nombre de usuario o correo (opcional)"/>
        <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">
          <button id="skipInviter" class="btn secondary">Omitir</button>
          <button id="submitInviter" class="btn primary">Enviar</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Auth modal -->
  <div id="authModal" class="modal">
    <div class="modal-card">
      <div class="modal-head">
        <div><h3>Cuenta .Nai / Google (simulado)</h3><div class="small">Crear o iniciar sesi√≥n</div></div>
        <button class="close" id="closeAuth">‚úï</button>
      </div>

      <div style="display:flex;gap:12px;margin-top:12px">
        <div style="flex:1">
          <label class="small">Crear .Nai (alias √∫nico)</label>
          <input id="naiAlias" class="input" placeholder="alias (sin .)"/>
          <input id="naiName" class="input" placeholder="Nombre visible" style="margin-top:8px"/>
          <input id="naiPass" class="input" type="password" placeholder="Contrase√±a" style="margin-top:8px"/>
          <button id="createNaiBtn" class="btn primary" style="margin-top:10px">Crear .Nai (+10 GUA)</button>
        </div>

        <div style="width:1px;background:var(--border)"></div>

        <div style="flex:1">
          <label class="small">Iniciar con Google (simulado)</label>
          <button id="googleBtn" class="btn" style="margin-top:8px">Continuar con Google (+10 GUA)</button>

          <div style="height:12px"></div>

          <label class="small">Entrar con .Nai</label>
          <input id="loginAlias" class="input" placeholder="alias (con o sin .)"/>
          <input id="loginPass" class="input" type="password" placeholder="Contrase√±a" style="margin-top:8px"/>
          <button id="loginBtnAuth" class="btn" style="margin-top:8px">Entrar</button>
        </div>
      </div>

      <div style="display:flex;justify-content:flex-end;margin-top:12px">
        <button id="closeAuth2" class="btn ghost">Cerrar</button>
      </div>
    </div>
  </div>

  <!-- Upload modal (detailed) -->
  <div id="uploadModal" class="modal">
    <div class="modal-card">
      <div class="modal-head"><div><h3>Subir video</h3></div><button class="close" id="closeUpload">‚úï</button></div>
      <div style="margin-top:12px">
        <input id="fileInput" type="file" accept="video/*,image/*" class="input"/>
        <input id="titleInput" class="input" placeholder="T√≠tulo" style="margin-top:8px"/>
        <textarea id="descInput" class="input" rows="3" placeholder="Descripci√≥n" style="margin-top:8px"></textarea>
        <input id="tagsInput" class="input" placeholder="Etiquetas (coma)" style="margin-top:8px"/>
        <label style="margin-top:8px" class="small">¬øEs tuyo?</label>
        <select id="isOriginal" class="input">
          <option value="yes">S√≠</option>
          <option value="no">No ‚Äî insertar enlace</option>
        </select>
        <input id="originalLink" class="input" placeholder="Enlace original (si no es tuyo)" style="margin-top:8px;display:none"/>
        <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">
          <button id="publishBtn" class="btn primary">Publicar</button>
          <button id="cancelUpload" class="btn">Cancelar</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Moderation panel -->
  <div id="moderPanel" class="modal">
    <div class="modal-card">
      <div class="modal-head"><div><h3>Panel de Moderaci√≥n</h3></div><button class="close" id="closeMod">‚úï</button></div>
      <div style="margin-top:12px;max-height:60vh;overflow:auto">
        <div id="modList" class="small"></div>
      </div>
      <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">
        <button id="modCloseBtn" class="btn">Cerrar</button>
      </div>
    </div>
  </div>

</div> <!-- .app -->

<!-- ======= SCRIPT ======= -->
<script>
/* Nai Nai - Prototipo completo (local, demo)
   Guarda estado en localStorage. No hay backend.
*/

/* ---------- Storage keys ---------- */
const KEY_USER = 'nai_user_v3';
const KEY_FEED = 'nai_feed_v3';
const KEY_REPORTS = 'nai_reports_v3';
const KEY_ACCEPTED = 'nai_rules_accepted_v3';
const KEY_INVITER = 'nai_inviter_v3';

/* ---------- Initial demo data ---------- */
const DEMO_FEED = [
  { id: 'v1', title:'Pancakes express', author:'.cocina', tags:['Cocina'], desc:'Receta r√°pida y f√°cil', format:'horizontal', likes:12, likedBy:[], comments:[], gua:5, created: Date.now()-3600*1000 },
  { id: 'v2', title:'Reacci√≥n al torneo', author:'@reactor', tags:['Videoreacci√≥n','Gaming'], desc:'Mi reacci√≥n al torneo', format:'vertical', likes:34, likedBy:[], comments:[], gua:12, created: Date.now()-7200*1000 },
  { id: 'v3', title:'Mini tutorial JS', author:'.dev', tags:['Educativo','Explicativo'], desc:'C√≥mo funciona X', format:'horizontal', likes:8, likedBy:[], comments:[], gua:3, created: Date.now()-100000 },
];

/* ---------- Utilities ---------- */
const $ = sel => document.querySelector(sel);
const $$ = sel => Array.from(document.querySelectorAll(sel));
const uid = (p='x') => p + Math.floor(Math.random()*999999);
const now = () => Date.now();

/* ---------- Load / Save ---------- */
let USER = JSON.parse(localStorage.getItem(KEY_USER) || 'null');
let FEED = JSON.parse(localStorage.getItem(KEY_FEED) || 'null') || DEMO_FEED.slice();
let REPORTS = JSON.parse(localStorage.getItem(KEY_REPORTS) || '[]');

function saveAll(){
  localStorage.setItem(KEY_USER, JSON.stringify(USER));
  localStorage.setItem(KEY_FEED, JSON.stringify(FEED));
  localStorage.setItem(KEY_REPORTS, JSON.stringify(REPORTS));
}

/* ---------- Helpers: GUA, roles, achievements ---------- */
const ACHIEVEMENTS = {
  'subidor-5day': {name:'Subidor (5 v√≠deos)', desc:'Sube 5 v√≠deos', img:''},
  'video-rate': {name:'Rate (video)', desc:'Tener un v√≠deo con rate'},
  'video-featured': {name:'Featured (video)', desc:'Tener un v√≠deo featured'},
  'acco
