<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Nai Nai ‚Äî Prototipo</title>

  <!-- ======= CSS INLINE (asegura que siempre cargue) ======= -->
  <style>
    :root{
      --bg:#0b0f1a; --bg2:#081028; --panel:#0f1530; --card:#121629;
      --text:#e6eef8; --muted:#98a3c7; --accent1:#4cc9f0; --accent2:#9b5de5;
      --border:rgba(255,255,255,0.04);
      --glass: rgba(255,255,255,0.02);
    }

    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter,system-ui,Arial,sans-serif;background:linear-gradient(180deg,var(--bg),var(--bg2));color:var(--text);-webkit-font-smoothing:antialiased}
    a{color:var(--accent1);text-decoration:none}
    .container{max-width:1200px;margin:0 auto;padding:18px}

    /* Overlay */
    .overlay{position:fixed;inset:0;background:linear-gradient(180deg,rgba(1,6,20,0.75),rgba(1,6,20,0.9));display:flex;align-items:center;justify-content:center;z-index:9999}
    .welcome-card{width:min(980px,96%);background:linear-gradient(180deg,var(--glass),rgba(255,255,255,0.007));border-radius:12px;padding:20px;border:1px solid var(--border);box-shadow:0 12px 40px rgba(0,0,0,0.6)}
    .welcome-header{display:flex;justify-content:space-between;align-items:flex-start;gap:14px}
    .welcome-left{display:flex;gap:12px;align-items:center}
    .logo-n{width:56px;height:56px;border-radius:10px;background:linear-gradient(90deg,var(--accent1),var(--accent2));display:flex;align-items:center;justify-content:center;font-weight:900;color:#021018;font-size:28px}
    .logo-n.small{width:40px;height:40px;font-size:18px}
    .welcome-title{font-size:24px;color:var(--accent1);margin:0}
    .welcome-sub{color:var(--muted)}
    .welcome-body{margin-top:12px}
    .card{background:var(--card);border-radius:10px;padding:12px;border:1px solid var(--border)}
    .small-muted{color:var(--muted);font-size:13px}
    .actions{display:flex;gap:12px;margin-top:12px}

    /* Buttons */
    .btn{background:linear-gradient(90deg,var(--accent1),var(--accent2));color:#021018;border:none;padding:10px 14px;border-radius:8px;cursor:pointer;font-weight:700}
    .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--text)}

    /* Terms modal */
    .terms-modal{margin-top:12px}
    .terms-area{max-height:60vh;overflow:auto;padding:12px;background:rgba(2,6,23,0.45);border-radius:8px;border:1px solid var(--border)}
    .terms-area h1,h2,h3{color:var(--accent1)}
    .terms-actions{margin-top:8px}

    /* Main header */
    .header{display:flex;align-items:center;gap:12px;justify-content:space-between;padding:12px 0;position:sticky;top:0;background:linear-gradient(180deg,rgba(2,6,23,0.6),transparent);z-index:50}
    .brand{display:flex;align-items:center;gap:10px}
    .brand-name{font-weight:800;color:var(--accent1)}
    .search{flex:1;display:flex;gap:8px;align-items:center;margin:0 16px}
    .search input{flex:1;padding:10px;border-radius:10px;border:1px solid var(--border);background:rgba(255,255,255,0.02);color:var(--text)}
    .search button{padding:10px;border-radius:10px;border:1px solid var(--border);background:transparent;color:var(--muted);cursor:pointer}

    /* Tag strip */
    .tags-strip{display:flex;gap:8px;padding:10px 0;overflow:auto;border-bottom:1px solid var(--border);margin-bottom:12px}
    .tag{padding:8px 12px;border-radius:999px;background:transparent;border:1px solid var(--border);color:var(--muted);cursor:pointer;white-space:nowrap}
    .tag.active{background:linear-gradient(90deg,var(--accent1),var(--accent2));color:#021018;border:none}

    /* Layout */
    .layout{display:grid;grid-template-columns:1fr 340px;gap:18px;padding:18px 0}
    .feed-controls{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
    .feed-list{display:flex;flex-direction:column;gap:12px}
    .video-item{display:flex;gap:12px;align-items:flex-start;border-radius:8px;padding:12px;background:linear-gradient(180deg,rgba(255,255,255,0.01),transparent);border:1px solid var(--border)}
    .thumb{width:200px;height:120px;background:linear-gradient(180deg,rgba(0,0,0,0.15),rgba(0,0,0,0.05));border-radius:8px;display:flex;align-items:center;justify-content:center;color:var(--muted);font-weight:700}
    .meta h4{margin:0;color:var(--accent1)}
    .meta p{margin:6px 0 0;color:var(--muted);font-size:13px}
    .infinite-indicator{text-align:center;margin-top:14px;color:var(--muted);font-weight:700}

    /* Side */
    .side{position:relative}
    .uploader label{display:block;margin-top:8px}
    .tag-select{display:flex;flex-wrap:wrap;gap:8px;margin-top:8px}
    .preview-box{margin-top:8px;border-radius:8px;min-height:80px;background:#06070a;border:1px solid var(--border);display:flex;align-items:center;justify-content:center;color:var(--muted)}
    .profile-block{display:flex;gap:12px;align-items:center}
    .avatar{width:68px;height:68px;border-radius:12px;background:linear-gradient(90deg,var(--accent1),var(--accent2));display:flex;align-items:center;justify-content:center;color:#021018;font-weight:800}
    .profile-name{font-weight:800}
    .achievements{margin-top:8px}
    .role-badge{display:inline-block;padding:6px 8px;border-radius:8px;background:rgba(255,255,255,0.02);border:1px solid var(--border);color:var(--muted);font-size:13px;margin-right:6px}

    /* Settings panel */
    .settings-panel{position:fixed;right:20px;top:80px;width:320px;background:linear-gradient(180deg,var(--card),rgba(0,0,0,0.6));padding:12px;border-radius:10px;border:1px solid var(--border);box-shadow:0 10px 30px rgba(0,0,0,0.5);z-index:300}
    .hidden{display:none}
    .tip{position:fixed;left:20px;bottom:90px;background:linear-gradient(90deg,var(--accent1),var(--accent2));color:#021018;padding:10px 12px;border-radius:10px;font-weight:700;z-index:250}

    /* Bottom nav */
    .bottom-nav{position:fixed;left:0;right:0;bottom:0;height:64px;background:linear-gradient(180deg,rgba(2,6,23,0.95),rgba(2,6,23,0.99));display:flex;align-items:center;justify-content:space-around;border-top:1px solid var(--border);z-index:90}
    .bottom-nav .btn{padding:10px 16px;border-radius:10px}

    /* Note area */
    .note-area{width:100%;padding:8px;border-radius:8px;background:#0b1328;color:var(--text);border:1px solid var(--border)}

    /* Responsive */
    @media (max-width:980px){
      .layout{grid-template-columns:1fr}
      .side{order:2}
      .search{margin:0}
      .logo-n{width:44px;height:44px;font-size:18px}
    }
  </style>
  <!-- ===== end css ===== -->
</head>
<body>
  <!-- ===== OVERLAY: bienvenida / reglas / origen ===== -->
  <div id="overlay" class="overlay" role="dialog" aria-modal="true">
    <div class="welcome-card" aria-labelledby="welcomeTitle">
      <div class="welcome-header">
        <div class="welcome-left" style="align-items:center">
          <div class="logo-n" aria-hidden="true">N</div>
          <div>
            <h1 id="welcomeTitle" class="welcome-title">Bienvenido a Nai Nai</h1>
            <div class="welcome-sub">Lee y acepta las reglas para continuar.</div>
          </div>
        </div>
        <div class="welcome-right">
          <div class="small-muted">Fecha de entrada en vigor: 27 de enero de 2026</div>
        </div>
      </div>

      <div class="welcome-body card" style="margin-top:12px">
        <strong>Reglas r√°pidas</strong>
        <ul>
          <li>Respeto y convivencia: no odio ni acoso. La cr√≠tica informativa permitida si est√° etiquetada.</li>
          <li>Etiquetas obligatorias: todo video requiere al menos una etiqueta predefinida.</li>
          <li>Nai Nai no muestra anuncios (ADS).</li>
          <li>GUA es un indicador de confianza; no garantiza ingresos.</li>
        </ul>

        <div class="small-muted">Al aceptar, confirmar√°s que conoces y aceptas los t√©rminos completos.</div>

        <div class="actions" style="margin-top:14px">
          <button id="btn-read" class="btn ghost" title="Leer el documento completo">Leer m√°s</button>
          <button id="btn-accept" class="btn">Aceptar</button>
        </div>
      </div>

      <!-- Terms modal (in-page) -->
      <div id="termsModal" class="card hidden terms-modal" aria-hidden="true" style="margin-top:12px">
        <div class="terms-area" id="termsContent">
          <!-- full legal text inserted by JS to keep HTML tidy -->
        </div>
        <div class="terms-actions" style="display:flex;gap:10px;justify-content:flex-end;margin-top:8px">
          <button id="btn-terms-accept" class="btn">Aceptar</button>
          <button id="btn-terms-close" class="btn ghost">Cerrar</button>
        </div>
      </div>

      <!-- ORIGIN FORM -->
      <form id="originForm" class="card hidden" onsubmit="return false" aria-hidden="true" style="margin-top:12px">
        <label for="originInput" style="font-weight:700;color:var(--muted)">¬øC√≥mo conociste Nai Nai? (usuario, correo o plataforma)</label>
        <input id="originInput" placeholder="Ej.: @amigo, twitter.user, correo@ej.com" required />
        <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:10px">
          <button id="btn-origin-submit" class="btn">Entrar oficialmente</button>
        </div>
        <div class="small-muted" style="margin-top:8px">No otorga beneficios; sirve para estad√≠sticas.</div>
      </form>
    </div>
  </div>

  <!-- TIP one-time -->
  <div id="tip" class="tip hidden">Puedes configurar casi todo desde Perfil ‚Üí Configuraci√≥n avanzada <button id="tipDismiss" class="btn ghost" style="margin-left:10px;padding:6px">Entendido</button></div>

  <!-- APP -->
  <div class="container" id="app" aria-hidden="true">
    <header class="header" role="banner">
      <div class="brand">
        <div class="logo-n small" aria-hidden="true" style="margin-right:8px">N</div>
        <div class="brand-name">Nai Nai</div>
      </div>

      <div class="search" role="search">
        <input id="searchInput" placeholder="Buscar por t√≠tulo, usuario, descripci√≥n, URL o etiqueta..." aria-label="Buscar">
        <button id="searchBtn" aria-label="Buscar">üîé</button>
      </div>

      <div class="header-links">
        <a id="openSettings" href="#" title="Configuraci√≥n">Configuraci√≥n</a>
        <a id="openProfile" href="#" title="Perfil">Perfil</a>
      </div>
    </header>

    <nav class="tags-strip" id="tagStrip" aria-label="Etiquetas">
      <button class="tag active" data-tag="all">Todos</button>
      <button class="tag" data-tag="Cocina">Cocina</button>
      <button class="tag" data-tag="Video reacci√≥n">Video reacci√≥n</button>
      <button class="tag" data-tag="Cr√≠tica">Cr√≠tica</button>
      <button class="tag" data-tag="Informativo">Informativo</button>
      <button class="tag" data-tag="Noticia">Noticia</button>
      <button class="tag" data-tag="Vlog">Vlog</button>
      <button class="tag" data-tag="Gaming">Gaming</button>
      <button class="tag" data-tag="Humor">Humor</button>
      <button class="tag" data-tag="Humor negro">Humor negro</button>
      <button class="tag" data-tag="Spoiler">Spoiler</button>
      <button class="tag" data-tag="No apto para todo p√∫blico">No apto para todo p√∫blico</button>
    </nav>

    <main class="layout" role="main">
      <section class="feed" aria-labelledby="feedTitle">
        <div class="feed-controls">
          <div><strong id="feedTitle">Feed</strong></div>
          <div class="feed-actions">
            <label class="small-muted" style="margin-right:8px">Orden</label>
            <select id="orderSelect" aria-label="Ordenar feed">
              <option value="new">M√°s nuevos</option>
              <option value="old">M√°s antiguos</option>
              <option value="rated">Mejor valorados</option>
              <option value="featured">Featured</option>
              <option value="certified">Certificado</option>
            </select>
          </div>
        </div>

        <div id="feedList" class="feed-list" aria-live="polite"></div>
        <div class="infinite-indicator" aria-hidden="true">‚àû Feed infinito</div>
      </section>

      <aside class="side" role="complementary">
        <div class="card uploader" aria-labelledby="uploaderTitle">
          <h3 id="uploaderTitle">Subir video</h3>
          <div class="small-muted">Invitados pueden subir videos. Las encuestas solo para usuarios registrados.</div>

          <label>Archivo
            <input id="fileInput" type="file" accept="video/*,image/*" />
          </label>

          <label>Etiquetas (selecciona al menos una)
            <div id="tagSelect" class="tag-select"></div>
          </label>

          <label>T√≠tulo
            <input id="titleInput" placeholder="T√≠tulo del video" />
          </label>

          <label>Descripci√≥n
            <input id="descInput" placeholder="Breve descripci√≥n / p√∫blico objetivo" />
          </label>

          <div style="display:flex;gap:8px;margin-top:10px">
            <button id="previewBtn" class="btn">Previsualizar</button>
            <button id="uploadBtn" class="btn">Subir (demo)</button>
          </div>

          <div id="previewBox" class="preview-box small-muted">Previsualizaci√≥n</div>
        </div>

        <div class="card profile-block" style="margin-top:12px">
          <div class="avatar" id="avatar">U</div>
          <div class="profile-info">
            <div id="displayName" class="profile-name">Invitado</div>
            <div class="small-muted" id="userTag">usuario no registrado</div>
            <div class="small-muted" id="guaDisplay">GUA: 0</div>
            <div id="achList" class="achievements"></div>
            <div style="margin-top:8px"><span id="roleBadge" class="role-badge">Usuario</span></div>
          </div>
        </div>

        <div class="card" style="margin-top:12px">
          <h4>Block de notas (privado)</h4>
          <textarea id="noteBlock" rows="5" class="note-area"></textarea>
          <div style="display:flex;gap:8px;margin-top:8px">
            <button id="saveNote" class="btn">Guardar</button>
            <button id="clearNote" class="btn ghost">Borrar</button>
          </div>
          <div class="small-muted" style="margin-top:8px">Si no est√°s registrado, las notas se guardan localmente.</div>
        </div>
      </aside>
    </main>

    <!-- settings panel -->
    <div id="settingsPanel" class="settings-panel hidden" aria-hidden="true">
      <h4>Configuraci√≥n avanzada</h4>

      <label>Modo fantasma
        <select id="ghostMode" class="select">
          <option value="off">Desactivado</option>
          <option value="on">Activado</option>
        </select>
      </label>

      <label>Confirmaciones ("¬øSeguro que quieres...?")
        <select id="confirmMode" class="select">
          <option value="always">Siempre</option>
          <option value="important">Solo acciones importantes</option>
          <option value="never">Nunca</option>
        </select>
      </label>

      <label>Recordatorios / mensajes (frecuencia)
        <select id="reminderFreq" class="select">
          <option value="never">Nunca</option>
          <option value="onEntry">Al entrar</option>
          <option value="5min">Cada 5 minutos</option>
          <option value="15min">Cada 15 minutos</option>
          <option value="daily">Una vez por d√≠a</option>
        </select>
      </label>

      <div style="display:flex;gap:8px;margin-top:10px">
        <button id="showTagsAll" class="tag">Mostrar todas</button>
        <button id="showTagsNone" class="tag">Ocultar</button>
      </div>

      <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">
        <button id="closeSettings" class="btn ghost">Cerrar</button>
        <button id="saveSettings" class="btn">Guardar</button>
      </div>
    </div>

    <div class="bottom-nav" role="navigation">
      <button id="navFeed" class="btn ghost">Feed</button>
      <button id="navUpload" class="btn">Subir</button>
      <button id="navProfile" class="btn ghost">Perfil</button>
    </div>
  </div>

  <!-- ===== JS INLINE (asegura funcionamiento) ===== -->
  <script>
  /* ---------------- CONSTANTS & HELPERS ---------------- */
  const LS_ACCEPT = 'nai_accepted_v1';
  const LS_ORIGIN = 'nai_origin_v1';
  const LS_SETTINGS = 'nai_settings_v1';
  const LS_NOTES = 'nai_notes_v1';
  const LS_TIP = 'nai_tip_seen_v1';

  const PREDEF_TAGS = ["Cocina","Video reacci√≥n","Cr√≠tica","Informativo","Noticia","Vlog","Gaming","Humor","Humor negro","Spoiler","No apto para todo p√∫blico"];

  const $ = id => document.getElementById(id);
  const qa = sel => Array.from(document.querySelectorAll(sel));
  const escapeHtml = s => String(s||'').replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));

  /* ---------- INIT ---------- */
  document.addEventListener('DOMContentLoaded', () => {
    // Insert full legal text into termsContent (we include the official document)
    const termsFull = `T√âRMINOS, CONDICIONES Y REGLAS DE USO DE NAI NAI
Fecha de entrada en vigor: 27 de enero de 2026

PRE√ÅMBULO
Nai Nai es una plataforma para la creaci√≥n, publicaci√≥n y distribuci√≥n de contenido audiovisual. Las presentes condiciones regulan el acceso y uso de la plataforma por parte de los usuarios. Al aceptar estas condiciones y utilizar la plataforma, el usuario declara conocerlas y aceptarlas sin reservas.

I. DEFINICIONES
1. Plataforma / Nai Nai: Servicio digital provisto por la entidad responsable de la aplicaci√≥n denominada "Nai Nai".
2. Usuario registrado: Persona que crea una cuenta en Nai Nai mediante los procedimientos previstos por la plataforma.
3. Usuario no registrado (invitado): Persona que utiliza la plataforma sin crear una cuenta formal; su uso est√° sujeto a limitaciones expresas en estas condiciones.
4. GUA: Indicador num√©rico de reputaci√≥n o confianza dentro de la comunidad Nai Nai.
5. Etiquetas: Clasificaciones predefinidas que deben asociarse a cada contenido publicado.
6. Contenido: Todo material audiovisual o textual subido por los usuarios, incluidos videos, im√°genes, descripciones y metadatos.
7. Moderadores / Administradores / Creador: Personas autorizadas por Nai Nai para supervisar, moderar y administrar la plataforma.
8. Monetizaci√≥n: Cualquier mecanismo de retribuci√≥n econ√≥mica a favor de usuarios o creadores dentro de la plataforma.

II. ACEPTACI√ìN Y PROCEDIMIENTO DE INGRESO
1. El acceso y uso de Nai Nai requiere la aceptaci√≥n previa y expresa de estas condiciones.
2. Al ingresar por primera vez, la pantalla de bienvenida mostrar√° un mensaje de acogida seguido de un resumen de las reglas principales. El usuario deber√° seleccionar una de las dos opciones presentadas: "Aceptar" o "Leer m√°s".
3. Si el usuario selecciona "Leer m√°s", se le presentar√° el presente documento en su integridad. Para acceder a la plataforma, el usuario deber√° pulsar el bot√≥n "Aceptar" al final del texto.
4. Antes de completar el acceso inicial y para fines estad√≠sticos y de origen de tr√°fico, el usuario deber√° indicar c√≥mo conoci√≥ Nai Nai. El campo correspondiente es de cumplimentaci√≥n obligatoria y aceptar√° nombre de usuario externo, direcci√≥n de correo, nombre de persona o denominaci√≥n de la plataforma externa por la que se accedi√≥. Dicha informaci√≥n se emplear√° con fines anal√≠ticos internos y no otorga derechos, ventajas econ√≥micas ni bonificaciones.

III. CUENTAS, CLASIFICACI√ìN Y CAPACIDADES
1. Usuario no registrado (invitado):
   a. Puede ver contenido, subir videos, comentar, dar "like" y realizar la mayor√≠a de interacciones.
   b. No puede crear encuestas dentro de la plataforma.
   c. No puede participar en ninguna modalidad de monetizaci√≥n.
   d. En su perfil y en cualquier interacci√≥n en la plataforma aparecer√° la etiqueta visible e inmodificable: "usuario no registrado".
   e. Nai Nai no asume responsabilidad por la p√©rdida de contenidos o datos pertenecientes a usuarios no registrados.
2. Usuario registrado:
   a. Dispone de las f
